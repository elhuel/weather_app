# weather.py

### **1. `get_location_id(api_key, latitude, longitude)`**

* **Назначение** : Получает **ключ местоположения (location key)** от AccuWeather API для заданных широты и долготы. Этот ключ используется для дальнейших запросов данных о погоде.
* **Логика работы** :

1. Формируется URL для API AccuWeather с заданным API-ключом, широтой и долготой.
2. Выполняется HTTP-запрос к API.
3. Ответ преобразуется в JSON-формат, и из него извлекается поле `"Key"`, которое представляет ключ местоположения.

---

### **2. `get_conditions(api_key, latitude, longitude)`**

* **Назначение** : Получает текущие и прогнозируемые погодные условия для заданных широты и долготы.
* **Логика работы** :

1. Вызывает функцию `get_location_id`, чтобы получить ключ местоположения.
2. Формирует два запроса к API AccuWeather:
   * Первый запрос получает данные о текущих погодных условиях.
   * Второй запрос получает прогноз на один день (дневная и ночная вероятность дождя).
3. Проверяет, что получены валидные данные.
4. Извлекает необходимые параметры:
   * **Температура (в градусах Цельсия)** .
   * **Относительная влажность (в процентах)** .
   * **Скорость ветра (в м/с)** .
   * **Вероятность дождя днем и ночью (в процентах)** .
5. Возвращает погодные данные в виде словаря.

---

### **3. `check_bad_weather(conditions)`**

* **Назначение** : Оценивает, насколько благоприятные погодные условия, используя метрику "оценки плохой погоды".
* **Логика работы** :

1. Инициализируется счетчик `bad_weather_score`, который увеличивается при неблагоприятных условиях:
   * Если вероятность дождя днем или ночью выше 70% → +1+1**+**1.
   * Если температура ниже 0°C или выше 35°C → +1+1**+**1.
   * Если скорость ветра превышает 15 м/с → +1+1**+**1.
2. На основе итогового значения `bad_weather_score` возвращается один из трех вариантов:
   * **0**: "Благоприятные погодные условия".
   * **1**: "Слегка неблагоприятные погодные условия".
   * 2: "Неблагоприятные погодные условия".

---

### **Пример работы:**

1. **Шаг 1** : Пользователь вызывает `get_conditions`, указывая API-ключ, широту и долготу.

* Функция запрашивает ключ местоположения, затем получает данные о текущей погоде и прогнозе.

1. **Шаг 2** : Результат передается в `check_bad_weather`.

* Проверяются вероятность дождя, температура и скорость ветра.
* На основе этих данных выводится заключение о погодных условиях.

---

# app.py


#### **1. Загрузка API-ключа**

* При запуске приложения API-ключ загружается из файла

#### **2. Главная страница `/`**

* **Маршрут** : Главная страница доступна по адресу `/`. Она поддерживает два HTTP-метода: `GET` и `POST`.
* **Методы обработки** :
* **`GET`** : При первом посещении страницы отображается форма для ввода координат (широты и долготы).
* **`POST`** : При отправке формы происходит обработка данных и выполнение следующих шагов:

##### **2.1 Валидация входных данных**

* Широта и долгота считываются из формы:
* Проверяется, что введенные значения являются числами и находятся в допустимом диапазоне

##### **2.2 Получение данных о погоде**

* Если координаты валидны, вызывается функция `get_conditions` из модуля `weather.py`
* Возможные результаты:
  * Если функция возвращает сообщение об ошибке, оно передается в шаблон, и пользователь видит его на странице.
  * Если функция возвращает погодные данные, они используются для дальнейшей обработки.

##### **2.3 Проверка благоприятности погоды**

* Используется функция `check_bad_weather` из модуля `weather.py`, чтобы оценить погодные условия
* Результат функции — одна из строк:* "Благоприятные погодные условия".
  * "Слегка неблагоприятные погодные условия".
  * "Неблагоприятные погодные условия".


##### **2.4 Формирование данных для отображения**

* Данные о погоде (температура, влажность, скорость ветра, вероятность дождя) извлекаются из ответа API
* Все значения передаются в шаблон `form.html` для отображения пользователю

#### **3. Шаблон `form.html`**

Шаблон отображает:

* Форма для ввода координат (широта и долгота).
* Информация о погоде (температура, влажность, вероятность дождя, скорость ветра) и оценка благоприятности.

Если произошла ошибка, шаблон отображает сообщение об ошибке.


#### **4. Запуск приложения**

Приложение запускается на локальном сервере (порт 8000, включен режим отладки)


### Итоговая работа:

1. Пользователь переходит на главную страницу, вводит широту и долготу.
2. Сервер валидирует координаты и запрашивает погоду через API.
3. Полученные данные о погоде и оценка благоприятности возвращаются пользователю в удобном виде.
